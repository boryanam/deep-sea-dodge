<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Sea Dodge: 60s Challenge</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #000b1a;
            color: white;
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow: hidden;
        }
        #menu, #countdown-overlay {
            position: absolute;
            z-index: 10;
            background: rgba(0, 11, 26, 0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #00ccff;
            box-shadow: 0 0 50px #004e92;
        }
        #countdown-overlay {
            display: none;
            background: transparent;
            border: none;
            box-shadow: none;
            font-size: 100px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px #ffcc00;
        }
        .btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        button {
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover { transform: scale(1.05); }
        .chill { background: #33ff57; color: #000; }
        .standard { background: #00ccff; color: #000; }
        .extreme { background: #ff4d4d; color: #fff; }

        .header-ui { margin-bottom: 10px; font-size: 24px; font-weight: bold; display: flex; gap: 50px; }
        #lives-display { color: #ff4d4d; }
        #level-display { color: #ffd700; }
        #powerup-ui { color: #fff; font-size: 18px; min-height: 24px; text-transform: uppercase; letter-spacing: 1px;}
        
        canvas {
            border: 6px solid #1a1a1a;
            background: #004e92;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border-radius: 12px;
            display: none;
        }
        .footer-ui {
            margin-top: 15px;
            font-size: 20px;
            color: #a3e4ff;
            background: rgba(0, 40, 80, 0.6);
            padding: 8px 25px;
            border-radius: 30px;
            display: none;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h1>DEEP SEA DODGE</h1>
        <p>Select Difficulty:</p>
        <div class="btn-group">
            <button class="chill" onclick="initCountdown(0.5)">CHILL</button>
            <button class="standard" onclick="initCountdown(1.0)">STANDARD</button>
            <button class="extreme" onclick="initCountdown(1.6)">EXTREME</button>
        </div>
        <p style="font-size: 0.9em; margin-top: 20px; color: #888;">Controls: [8] Up | [2] Down | [Space] Dash</p>
    </div>

    <div id="countdown-overlay">3</div>

    <div class="header-ui" id="ui-top" style="display:none;">
        <div id="level-display">üåä LEVEL: <span id="level">1</span></div>
        <div id="lives-display">‚ù§Ô∏è LIVES: <span id="lives">3</span></div>
    </div>
    <div id="powerup-ui"></div>

    <canvas id="gameCanvas" width="850" height="450"></canvas>

    <div class="footer-ui" id="ui-bot">
        ‚è±Ô∏è Time: <span id="timer">0.0</span>s / 60s | [8] UP [2] DOWN | [SPACE] DASH
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timerEl = document.getElementById('timer');
        const livesEl = document.getElementById('lives');
        const levelEl = document.getElementById('level');
        const powerupEl = document.getElementById('powerup-ui');
        const countdownEl = document.getElementById('countdown-overlay');

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type, start, duration, volume = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + start);
            gain.gain.setValueAtTime(volume, audioCtx.currentTime + start);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + start + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + start);
            osc.stop(audioCtx.currentTime + start + duration);
        }

        let gameActive = false;
        let difficultyMultiplier = 1.0;
        let lives = 3;
        let currentLevel = 1;
        let startTime = 0;
        let invincibilityTimer = 0;
        let dashCooldown = 0;
        const gameDuration = 60; // Increased to 60s

        const player = { x: 80, y: 225, width: 50, height: 35, speed: 7, color: '#00ccff', dashing: 0 };
        const fishes = [];

        function initCountdown(mult) {
            difficultyMultiplier = mult;
            document.getElementById('menu').style.display = 'none';
            countdownEl.style.display = 'block';
            
            let count = 3;
            countdownEl.innerText = count;
            playTone(440, 'sine', 0, 0.1); // "Beep"

            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.innerText = count;
                    playTone(440, 'sine', 0, 0.1);
                } else {
                    clearInterval(interval);
                    countdownEl.style.display = 'none';
                    startGame();
                }
            }, 1000);
        }

        function startGame() {
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('ui-top').style.display = 'flex';
            document.getElementById('ui-bot').style.display = 'block';
            gameActive = true;
            startTime = Date.now();
            playTone(880, 'sine', 0, 0.3); // High "Start" Beep
            loop();
        }

        function createFish(type = 'normal') {
            const size = type === 'golden' ? 30 : (type === 'bomb' ? 40 : Math.random() * 30 + 20);
            let speed = ( (Math.random() * 2 + 2.5) + (currentLevel * 0.7) ) * difficultyMultiplier;
            
            fishes.push({
                x: canvas.width + 60,
                y: Math.random() * (canvas.height - size),
                width: size,
                height: size * 0.7,
                speed: type === 'golden' ? 4 * difficultyMultiplier : speed,
                color: type === 'golden' ? '#FFD700' : (type === 'bomb' ? '#333' : '#FF5733'),
                type: type,
                state: type === 'bomb' ? 'priming' : 'swimming', 
                timer: 0,
                phase: Math.random() * Math.PI * 2
            });
        }

        const keys = {};
        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.code === 'Space' && dashCooldown <= 0 && gameActive) {
                player.dashing = 15;
                dashCooldown = 120;
                playTone(600, 'sine', 0, 0.1, 0.2);
            }
        });
        window.addEventListener('keyup', e => keys[e.key] = false);

        function drawFish(f, isPlayer = false) {
            const time = Date.now() / 1000;
            const wave = Math.sin(time * 12 + (f.phase || 0)) * 12;
            ctx.save();
            ctx.translate(f.x + f.width / 2, f.y + f.height / 2);
            if (!isPlayer) ctx.scale(-1, 1);
            if (f.type === 'bomb' && f.state === 'priming') {
                let pulse = (Math.sin(time * 20) + 1) / 2;
                ctx.shadowBlur = 15 + pulse * 20; ctx.shadowColor = "red";
                ctx.fillStyle = `rgb(${150 + pulse * 105}, 0, 0)`;
            } else if (f.type === 'golden' || (isPlayer && invincibilityTimer > 0)) {
                ctx.shadowBlur = 15; ctx.shadowColor = "yellow"; ctx.fillStyle = f.color;
            } else { ctx.fillStyle = f.color; }
            ctx.beginPath();
            ctx.moveTo(-f.width / 2, 0); ctx.lineTo(-f.width / 2 - 15, -10 + wave); ctx.lineTo(-f.width / 2 - 15, 10 + wave); ctx.fill();
            ctx.beginPath(); ctx.ellipse(0, 0, f.width/2, f.height/2, 0, 0, Math.PI * 2); ctx.fill();
            if (isPlayer && dashCooldown > 0) {
                ctx.fillStyle = "white"; ctx.fillRect(-f.width/2, f.height/2 + 5, f.width * (dashCooldown/120), 3);
            }
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(f.width/4, -f.height/6, 4, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(f.width/4 + 1, -f.height/6, 2, 0, Math.PI * 2); ctx.fill();
            if (isPlayer && invincibilityTimer > 0) {
                ctx.strokeStyle = "rgba(255, 255, 255, " + (0.5 + Math.sin(time*10)*0.3) + ")";
                ctx.lineWidth = 3; ctx.beginPath(); ctx.arc(0, 0, f.width, 0, Math.PI*2); ctx.stroke();
            }
            ctx.restore();
            if (f.state === 'exploding') {
                ctx.beginPath(); ctx.arc(f.x + f.width/2, f.y + f.height/2, f.timer * 60, 0, Math.PI*2);
                ctx.fillStyle = `rgba(255, 100, 0, ${1 - f.timer/2})`; ctx.fill();
            }
        }

        function update() {
            if (!gameActive) return;
            let elapsed = (Date.now() - startTime) / 1000;
            timerEl.innerText = elapsed.toFixed(1);
            if (invincibilityTimer > 0) invincibilityTimer -= 1/60;
            if (dashCooldown > 0) dashCooldown--;

            // Level Logic for 60s
            let newLevel = Math.min(3, Math.floor(elapsed / 20) + 1);
            if (newLevel !== currentLevel) {
                currentLevel = newLevel; levelEl.innerText = currentLevel; playTone(880, 'sine', 0, 0.1);
            }

            if (elapsed >= gameDuration) {
                gameActive = false; playTone(523, 'square', 0, 0.4);
                setTimeout(() => { alert("LEGENDARY VICTORY! You survived 60 seconds!"); location.reload(); }, 500); return;
            }

            let currentSpeed = player.speed;
            if (player.dashing > 0) { currentSpeed *= 3; player.dashing--; }
            if (keys['8'] && player.y > 0) player.y -= currentSpeed;
            if (keys['2'] && player.y < canvas.height - player.height) player.y += currentSpeed;

            if (Math.random() < 0.01 + (currentLevel * 0.02)) createFish('normal');
            if (Math.random() < 0.003) createFish('golden');
            if (Math.random() < 0.005) createFish('bomb');

            for (let i = fishes.length - 1; i >= 0; i--) {
                let f = fishes[i];
                if (f.state === 'priming') {
                    f.x -= f.speed; f.timer += 1/60;
                    if (f.timer >= 3) { f.state = 'exploding'; f.timer = 0; playTone(50, 'sawtooth', 0, 0.4, 0.3); }
                } else if (f.state === 'swimming') { f.x -= f.speed;
                } else if (f.state === 'exploding') {
                    f.timer += 1/30;
                    let dx = (player.x + player.width/2) - (f.x + f.width/2);
                    let dy = (player.y + player.height/2) - (f.y + f.height/2);
                    if (Math.sqrt(dx*dx + dy*dy) < 110 && invincibilityTimer <= 0) {
                        lives--; livesEl.innerText = lives; invincibilityTimer = 1;
                        if (lives <= 0) { gameActive = false; setTimeout(() => { alert("GAME OVER!"); location.reload(); }, 100); }
                    }
                    if (f.timer > 1) fishes.splice(i, 1);
                }
                let dx = (player.x + player.width/2) - (f.x + f.width/2);
                let dy = (player.y + player.height/2) - (f.y + f.height/2);
                if (f.state !== 'exploding' && Math.sqrt(dx*dx + dy*dy) < 35) {
                    if (f.type === 'golden') { invincibilityTimer = 5; playTone(1760, 'sine', 0, 0.3); fishes.splice(i, 1);
                    } else if (invincibilityTimer <= 0) {
                        lives--; livesEl.innerText = lives; fishes.splice(i, 1);
                        if (lives <= 0) { gameActive = false; setTimeout(() => { alert("GAME OVER!"); location.reload(); }, 100);
                        } else { playTone(150, 'sawtooth', 0, 0.2); }
                    }
                }
                if (f.x < -100) fishes.splice(i, 1);
            }
        }

        function loop() {
            if (!gameActive) return;
            ctx.fillStyle = '#004e92';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            update();
            fishes.forEach(f => drawFish(f));
            drawFish(player, true);
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>

